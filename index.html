<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LAIKIPIA COMRADE ‚Äî Anonymous Chat</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --dark-1:#06040a; --dark-2:#10051a;
  --neon-purple:#8b5cf6; --neon-cyan:#06b6d4;
  --text-main:#e8e8f0; --muted:#9aa0b4;
  --gold-1:#fff8ef; --gold-2:#fff0d6; --gold-accent:#d4af37;
}

/* basic body & font */
body{margin:0;font-family:'Inter',system-ui,Arial,sans-serif;background:var(--dark-1);color:var(--text-main);display:flex;align-items:center;justify-content:center;height:100vh;}

/* AUTH */
.authCard{padding:18px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.03));border:1px solid rgba(255,255,255,0.06); max-width:420px; width:100%;}
.field{display:flex;flex-direction:column;gap:8px;margin-bottom:8px}
.field input{padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text-main)}
.rowBtns{display:flex;gap:10px;margin-top:6px}
.btnPrimary{flex:1;padding:12px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--neon-purple),var(--neon-cyan));color:#06102a;font-weight:800;cursor:pointer}
.btnGhost{flex:1;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text-main);font-weight:700;cursor:pointer}
.statusMsg{color:#ffb4b4;font-size:13px;min-height:18px;margin-top:8px}

/* FULLSCREEN CHAT */
.chatFullScreen {position:fixed;top:0;left:0;width:100vw;height:100vh;background:linear-gradient(180deg,var(--gold-1),var(--gold-2));display:flex;flex-direction:column;z-index:100;}
.logoutFloatBtn {position:absolute;top:14px;right:14px;padding:10px 14px;border-radius:20px;border:none;background:linear-gradient(90deg,var(--neon-purple),var(--neon-cyan));color:#fff;font-weight:700;cursor:pointer;z-index:101;}

.chatHeader{display:flex;align-items:center;justify-content:space-between;padding:14px;border-bottom:1px solid rgba(0,0,0,0.03);}
.chatTitle{font-weight:800;color:#1b1b1b}
.chatSub{color:#4a4a4a;font-size:13px}
.onlineCount{font-size:13px;color:#666}

#messagesList {flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:8px;scroll-behavior:smooth;}
.messageBubble {opacity:0;transform:translateY(20px);transition:transform 0.3s ease,opacity 0.3s ease;}
.messageBubble.show {opacity:1;transform:translateY(0);}
.messageMine{background:linear-gradient(180deg,#fff7e6,#fff5df);align-self:flex-end;border-bottom-right-radius:4px;}
.messageOther{background:#ffffff;align-self:flex-start;border-bottom-left-radius:4px;}
.senderName{font-size:12px;font-weight:600;margin-bottom:4px;color:#555;}
.messageContent{font-size:14px;color:#111;word-wrap:break-word;}

.inputBar{display:flex;padding:12px;gap:8px;border-top:1px solid rgba(0,0,0,0.04);align-items:center;background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.55));}
.inputBar input[type="text"]{flex:1;padding:10px;border-radius:20px;border:1px solid rgba(0,0,0,0.06);outline:none;background:white;color:#111}
.btnRound{padding:10px;border-radius:50%;border:none;background:linear-gradient(90deg,var(--gold-accent),#b8860b);cursor:pointer;font-weight:700;color:#111}
input[type="file"]{display:none}
</style>
</head>
<body>

<!-- LOGIN / REGISTER -->
<div class="authCard" id="authContainer">
  <div class="authTitle">LAIKIPIA COMRADE</div>
  <div class="field">
    <input id="emailInput" type="email" placeholder="Email" autocomplete="username" />
    <input id="passwordInput" type="password" placeholder="Password" autocomplete="current-password" />
  </div>
  <div class="rowBtns">
    <button class="btnPrimary" id="loginBtn">Login</button>
    <button class="btnGhost" id="registerBtn">Register</button>
  </div>
  <div class="statusMsg" id="authStatus"></div>
</div>

<!-- FULLSCREEN CHAT -->
<div class="chatFullScreen" id="messagesContainer" style="display:none">
  <button class="logoutFloatBtn" id="logoutBtn">Logout</button>
  <div class="chatHeader">
    <div style="display:flex;gap:12px;align-items:center">
      <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(90deg,var(--neon-purple),var(--neon-cyan));display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff" id="miniAvatar">LC</div>
      <div>
        <div class="chatTitle">Laikipia Comrades</div>
        <div class="chatSub">Anonymous community</div>
      </div>
    </div>
    <div class="onlineCount" id="onlineCount">‚Äî active</div>
  </div>
  <div id="messagesList" aria-live="polite"></div>
  <div class="inputBar">
    <button class="btnRound" id="attachBtn" title="Attach image">üìé</button>
    <button class="btnRound" id="voiceBtn" title="Record audio">üé§</button>
    <input id="msgInput" type="text" placeholder="Type a message..." />
    <button class="btnRound" id="sendBtn" title="Send">‚û°Ô∏è</button>
    <input type="file" id="fileInput" accept="image/*" />
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, query, limitToLast } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";
import { getAuth, onAuthStateChanged, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

const FIREBASE_CONFIG = {
  apiKey: "AIzaSyDxrcdSofjGYjHVihYIFJHOF0VjCQjsKN4",
  authDomain: "laikipia-49112.firebaseapp.com",
  projectId: "laikipia-49112",
  storageBucket: "laikipia-49112.firebasestorage.app",
  messagingSenderId: "677277411058",
  appId: "1:677277411058:web:f9da4a4e56d58fc442526b",
  measurementId: "G-NM0C5G42DP"
};

const app = initializeApp(FIREBASE_CONFIG);
const db = getDatabase(app);
const auth = getAuth(app);

const loginBtn=document.getElementById('loginBtn');
const registerBtn=document.getElementById('registerBtn');
const emailInput=document.getElementById('emailInput');
const passwordInput=document.getElementById('passwordInput');
const authStatus=document.getElementById('authStatus');
const authContainer=document.getElementById('authContainer');
const messagesContainer=document.getElementById('messagesContainer');
const messagesList=document.getElementById('messagesList');
const logoutBtn=document.getElementById('logoutBtn');
const msgInput=document.getElementById('msgInput');
const sendBtn=document.getElementById('sendBtn');
const attachBtn=document.getElementById('attachBtn');
const fileInput=document.getElementById('fileInput');
const voiceBtn=document.getElementById('voiceBtn');
const onlineCount=document.getElementById('onlineCount');
const miniAvatar=document.getElementById('miniAvatar');

function generateAnonName(){
  const w1=["Silver","Blue","Golden","Silent","Rapid","Misty","Shadow","Bright","Wild","Crimson"];
  const w2=["Falcon","Leaf","River","Lion","Wolf","Star","Cloud","Hawk","Dune","Comet"];
  return w1[Math.floor(Math.random()*w1.length)] + ' ' + w2[Math.floor(Math.random()*w2.length)];
}

async function register(){
  authStatus.textContent='';
  try{
    const userCredential=await createUserWithEmailAndPassword(auth,emailInput.value,passwordInput.value);
    const user=userCredential.user;
    const anonName=generateAnonName();
    await updateProfile(user,{displayName:anonName});
    showMessages();
  }catch(e){authStatus.textContent=e.message;}
}

async function login(){
  authStatus.textContent='';
  try{await signInWithEmailAndPassword(auth,emailInput.value,passwordInput.value);showMessages();}
  catch(e){authStatus.textContent=e.message;}
}

function showMessages(){authContainer.style.display='none';messagesContainer.style.display='flex';}

const messagesRef = query(ref(db,'messages'), limitToLast(100));
onChildAdded(messagesRef, snapshot=>{
  const msg = snapshot.val(); if(!msg) return;
  const div = document.createElement('div');
  div.className = 'messageBubble ' + (msg.uid === auth.currentUser?.uid ? 'messageMine':'messageOther');
  const senderEl=document.createElement('div'); senderEl.className='senderName'; senderEl.textContent=msg.anonName||'Anonymous'; div.appendChild(senderEl);
  const contentEl=document.createElement('div'); contentEl.className='messageContent';
  if(msg.type==='image'){const img=document.createElement('img'); img.src=msg.imageData; img.style.maxWidth='260px'; img.style.borderRadius='12px'; contentEl.appendChild(img);}
  else if(msg.type==='audio'){const audio=document.createElement('audio'); audio.controls=true; audio.src=msg.audioData; contentEl.appendChild(audio);}
  else{contentEl.textContent=msg.text||'';}
  div.appendChild(contentEl);
  messagesList.appendChild(div);
  requestAnimationFrame(()=>div.classList.add('show'));
  messagesList.scrollTop=messagesList.scrollHeight;
});

sendBtn.onclick=async()=>{
  const text=msgInput.value.trim(); if(!text) return;
  const user=auth.currentUser;
  await push(ref(db,'messages'),{text,uid:user.uid,anonName:user.displayName,type:'text',ts:Date.now()});
  msgInput.value='';
};

attachBtn.onclick=()=>fileInput.click();
fileInput.onchange=()=>{const file=fileInput.files[0];if(!file) return; const reader=new FileReader(); reader.onload=async()=>{const user=auth.currentUser; await push(ref(db,'messages'),{type:'image',imageData:reader.result,uid:user.uid,anonName:user.displayName,ts:Date.now()}); fileInput.value='';}; reader.readAsDataURL(file);};

logoutBtn.onclick=()=>signOut(auth).then(()=>location.reload());

onAuthStateChanged(auth,user=>{
  if(user){showMessages(); miniAvatar.textContent=(user.displayName||'LC').split(' ').map(s=>s[0]).slice(0,2).join('').toUpperCase(); if(!user.displayName) updateProfile(user,{displayName:generateAnonName()}).catch(()=>{});}
  else{authContainer.style.display='block'; messagesContainer.style.display='none';}
});

const authors=new Set();
onChildAdded(query(ref(db,'messages'), limitToLast(200)), snap=>{const m=snap.val(); if(m && m.anonName) authors.add(m.anonName); onlineCount.textContent=`${authors.size} active`;});

loginBtn.onclick=login;
registerBtn.onclick=register;
</script>
</body>
</html>
